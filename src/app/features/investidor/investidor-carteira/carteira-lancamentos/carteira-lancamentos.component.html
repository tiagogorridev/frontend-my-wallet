<app-investidor-header></app-investidor-header>
<div class="dashboard-container">
  <main class="lancamentos-content">
    <section class="lancamentos-section">
      <div class="section-header">
        <h2>Lançamentos</h2>
        <div class="filters">
          <div class="filter-dropdown" (click)="$event.stopPropagation()">
            <div class="dropdown-trigger" (click)="toggleDropdown(dropdowns[0])">
              <span>{{ dropdowns[0].label }}</span>
              <span class="dropdown-icon">▼</span>
            </div>
            <ul class="dropdown-menu" *ngIf="dropdowns[0].isOpen">
              <li
                *ngFor="let option of dropdowns[0].options"
                (click)="selectOption(dropdowns[0], option)"
              >
                {{ option }}
              </li>
            </ul>
          </div>

          <div class="filter-dropdown" (click)="$event.stopPropagation()">
            <div class="dropdown-trigger" (click)="toggleDropdown(dropdowns[1])">
              <span>{{ dropdowns[1].label }}</span>
              <span class="dropdown-icon">▼</span>
            </div>
            <ul class="dropdown-menu" *ngIf="dropdowns[1].isOpen">
              <li
                *ngFor="let option of dropdowns[1].options"
                (click)="selectOption(dropdowns[1], option)"
              >
                {{ option }}
              </li>
            </ul>
          </div>
          <button class="add-lancamento-btn" (click)="openModal()">Adicionar Ativo +</button>
        </div>
      </div>

      <div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()">
        <div class="modal-container" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>Adicionar Novo Ativo</h2>
            <button class="close-btn" (click)="closeModal()">✕</button>
          </div>

          <form [formGroup]="assetForm" (ngSubmit)="onSubmit()">
            <div class="form-group">
              <label for="type">Tipo de Ativo</label>
              <select id="type" formControlName="type" class="form-control">
                <option value="">Selecione o tipo</option>
                <option *ngFor="let type of assetTypes" [value]="type.value">
                  {{ type.label }}
                </option>
              </select>
              <div *ngIf="assetForm.get('type')?.touched && assetForm.get('type')?.invalid" class="error-message">
                Tipo de ativo é obrigatório
              </div>
            </div>

            <div class="form-group">
              <label for="name">Nome do Ativo</label>
              <input
                type="text"
                id="name"
                formControlName="name"
                class="form-control"
                placeholder="Ex: Bitcoin, Tesouro Direto"
              >
              <div *ngIf="assetForm.get('name')?.touched && assetForm.get('name')?.invalid" class="error-message">
                Nome do ativo é obrigatório
              </div>
            </div>

            <div class="form-group">
              <label for="currentPrice">Preço Atual</label>
              <input
                type="number"
                id="currentPrice"
                formControlName="currentPrice"
                class="form-control"
                step="0.01"
                placeholder="R$ 0,00"
              >
              <div *ngIf="assetForm.get('currentPrice')?.touched && assetForm.get('currentPrice')?.invalid" class="error-message">
                Preço atual inválido
              </div>
            </div>

            <div class="form-group">
              <label for="purchaseDate">Data de Compra</label>
              <input
                type="date"
                id="purchaseDate"
                formControlName="purchaseDate"
                class="form-control"
              >
              <div *ngIf="assetForm.get('purchaseDate')?.touched && assetForm.get('purchaseDate')?.invalid" class="error-message">
                Data de compra é obrigatória
              </div>
            </div>

            <div class="form-group">
              <label for="quantity">Quantidade</label>
              <input
                type="number"
                id="quantity"
                formControlName="quantity"
                class="form-control"
                step="0.001"
                placeholder="0,000"
              >
              <div *ngIf="assetForm.get('quantity')?.touched && assetForm.get('quantity')?.invalid" class="error-message">
                Quantidade inválida
              </div>
            </div>

            <div class="form-group">
              <label for="purchaseValue">Valor Comprado</label>
              <input
                type="number"
                id="purchaseValue"
                formControlName="purchaseValue"
                class="form-control"
                step="0.01"
                placeholder="R$ 0,00"
              >
              <div *ngIf="assetForm.get('purchaseValue')?.touched && assetForm.get('purchaseValue')?.invalid" class="error-message">
                Valor de compra inválido
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-cancel" (click)="closeModal()">Cancelar</button>
              <button type="submit" class="btn-confirm">Adicionar Ativo</button>
            </div>
          </form>
        </div>
      </div>

      <div class="categorias-container">
        <div class="categoria-tabs">
          <button
            *ngFor="let categoria of categorias"
            (click)="selecionarCategoria(categoria)"
            [class.active]="categoriaSelecionada === categoria"
          >
            {{ categoria }}
          </button>
        </div>

        <div class="lancamentos-table-container">
          <table class="lancamentos-table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Tipo</th>
                <th>Ativo</th>
                <th>Descrição</th>
                <th>Quantidade</th>
                <th>Valor Unitário</th>
                <th>Valor Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let lancamento of filtrarLancamentos()">
                <td>{{ lancamento.data }}</td>
                <td>
                  <span
                    class="lancamento-tipo"
                    [ngClass]="{
                      'compra': lancamento.tipo === 'Compra',
                      'venda': lancamento.tipo === 'Venda',
                      'dividendo': lancamento.tipo === 'Dividendo'
                    }"
                  >
                    {{ lancamento.tipo }}
                  </span>
                </td>
                <td>{{ lancamento.ativo }}</td>
                <td>{{ lancamento.descricao }}</td>
                <td>{{ lancamento.quantidade }}</td>
                <td>R$ {{ lancamento.valorUnitario | number:'1.2-2' }}</td>
                <td>R$ {{ lancamento.valorTotal | number:'1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="categoria-summary">
          <div class="summary-card">
            <div class="card-title">Total Investido</div>
            <div class="card-value">
              R$ {{ calcularTotalInvestido(filtrarLancamentos()) | number:'1.2-2' }}
            </div>
          </div>
          <div class="summary-card">
            <div class="card-title">Total Resgatado</div>
            <div class="card-value">
              R$ {{ calcularTotalResgatado(filtrarLancamentos()) | number:'1.2-2' }}
            </div>
          </div>
          <div class="summary-card">
            <div class="card-title">Dividendos</div>
            <div class="card-value positive">
              R$ {{ calcularDividendos(filtrarLancamentos()) | number:'1.2-2' }}
            </div>
          </div>
        </div>

        <div class="lancamentos-pagination">
          <button class="pagination-btn prev">Anterior</button>
          <div class="page-numbers">
            <button class="page-btn active">1</button>
            <button class="page-btn">2</button>
            <button class="page-btn">3</button>
            <span>...</span>
            <button class="page-btn">10</button>
          </div>
          <button class="pagination-btn next">Próximo</button>
        </div>
      </div>
    </section>

    <section class="lancamentos-summary">
      <div class="summary-header">
        <h3>Resumo do Período</h3>
        <div class="period-display">01/03/2025 - 20/03/2025</div>
      </div>
      <div class="summary-cards">
        <div class="summary-card">
          <div class="card-title">Total Investido</div>
          <div class="card-value">R$ 5.987,50</div>
        </div>
        <div class="summary-card">
          <div class="card-title">Total Resgatado</div>
          <div class="card-value">R$ 3.296,00</div>
        </div>
        <div class="summary-card">
          <div class="card-title">Rendimentos</div>
          <div class="card-value positive">R$ 117,50</div>
        </div>
        <div class="summary-card">
          <div class="card-title">Saldo</div>
          <div class="card-value">R$ 2.809,00</div>
        </div>
      </div>
    </section>

    <section class="lancamentos-summary">
      <div class="summary-header">
        <h3>Resumo do Período</h3>
        <div class="period-display">01/03/2025 - 20/03/2025</div>
      </div>
      <div class="summary-cards">
        <div class="summary-card">
          <div class="card-title">Total Investido</div>
          <div class="card-value">R$ 5.987,50</div>
        </div>
        <div class="summary-card">
          <div class="card-title">Total Resgatado</div>
          <div class="card-value">R$ 3.296,00</div>
        </div>
        <div class="summary-card">
          <div class="card-title">Rendimentos</div>
          <div class="card-value positive">R$ 117,50</div>
        </div>
        <div class="summary-card">
          <div class="card-title">Saldo</div>
          <div class="card-value">R$ 2.809,00</div>
        </div>
      </div>
    </section>
  </main>
</div>
