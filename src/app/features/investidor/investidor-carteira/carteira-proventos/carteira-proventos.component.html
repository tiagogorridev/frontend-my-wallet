<app-investidor-header></app-investidor-header>
<div class="dashboard-container">
  <main class="main-content">
    <section class="chart-section">
      <div class="section-header">
        <h2>Evolução dos Proventos</h2>
        <div class="filters">
          <div class="filter-dropdown" (click)="$event.stopPropagation()">
            <div class="dropdown-trigger" (click)="toggleDropdown(dropdowns[0])">
              <span>{{ dropdowns[0].label }}</span>
              <span class="dropdown-icon">▼</span>
            </div>
            <ul class="dropdown-menu" *ngIf="dropdowns[0].isOpen">
              <li
                *ngFor="let option of dropdowns[0].options"
                (click)="selectOption(dropdowns[0], option)"
              >
                {{ option }}
              </li>
            </ul>
          </div>

          <div class="filter-dropdown" (click)="$event.stopPropagation()">
            <div class="dropdown-trigger" (click)="toggleDropdown(dropdowns[1])">
              <span>{{ dropdowns[1].label }}</span>
              <span class="dropdown-icon">▼</span>
            </div>
            <ul class="dropdown-menu" *ngIf="dropdowns[1].isOpen">
              <li
                *ngFor="let option of dropdowns[1].options"
                (click)="selectOption(dropdowns[1], option)"
              >
                {{ option }}
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="chart-container" style="height: 400px; width: 100%;">
        <canvas #patrimonioChart></canvas>
      </div>
    </section>
  </main>

  <section class="income-summary-section">
    <div class="section-header">
      <h2>Resumo de Proventos</h2>
      <div class="year-selector">
        <span class="year-nav prev" (click)="navigatePrevYear()">◄</span>
        <span class="current-year">{{ selectedYear }}</span>
        <span class="year-nav next" (click)="navigateNextYear()">►</span>
      </div>
    </div>

    <div class="income-summary-container">
      <div class="summary-cards">
        <div class="summary-card">
          <div class="card-title">Total Recebido</div>
          <div class="card-value">R$ 1.345,25</div>
          <div class="card-comparison positive">+12,5% vs 2024</div>
        </div>
        <div class="summary-card">
          <div class="card-title">Média Mensal</div>
          <div class="card-value">R$ 224,20</div>
          <div class="card-comparison positive">+8,2% vs 2024</div>
        </div>
        <div class="summary-card">
          <div class="card-title">Yield</div>
          <div class="card-value">4,3%</div>
          <div class="card-comparison positive">+0,5% vs 2024</div>
        </div>
        <div class="summary-card">
          <div class="card-title">Projeção Anual</div>
          <div class="card-value">R$ 2.690,50</div>
          <div class="card-comparison positive">+15,3% vs 2024</div>
        </div>
      </div>

      <div class="monthly-chart-container">
        <div class="monthly-distribution-bars">
          <div class="month-bar">
            <div class="bar-container">
              <div class="bar-value" style="height: 60%"></div>
            </div>
            <div class="month-value">R$ 145,20</div>
            <div class="month-name">Jan / {{ selectedYear }}</div>
          </div>
          <div class="month-bar future">
            <div class="bar-container">
              <div class="bar-value future-bar" style="height: 65%"></div>
            </div>
            <div class="month-value">R$ 165,20</div>
            <div class="month-name">Fev / {{ selectedYear }}</div>
          </div>
          <div class="month-bar">
            <div class="bar-container">
              <div class="bar-value" style="height: 100%"></div>
            </div>
            <div class="month-value">R$ 320,75</div>
            <div class="month-name">Mar / {{ selectedYear }}</div>
          </div>
          <div class="month-bar">
            <div class="bar-container">
              <div class="bar-value" style="height: 30%"></div>
            </div>
            <div class="month-value">R$ 95,30</div>
            <div class="month-name">Abr / {{ selectedYear }}</div>
          </div>
          <div class="month-bar">
            <div class="bar-container">
              <div class="bar-value" style="height: 50%"></div>
            </div>
            <div class="month-value">R$ 125,80</div>
            <div class="month-name">Mai / {{ selectedYear }}</div>
          </div>
          <div class="month-bar">
            <div class="bar-container">
              <div class="bar-value" style="height: 70%"></div>
            </div>
            <div class="month-value">R$ 175,40</div>
            <div class="month-name">Jun / {{ selectedYear }}</div>
          </div>
          <div class="month-bar future">
            <div class="bar-container">
              <div class="bar-value future-bar" style="height: 65%"></div>
            </div>
            <div class="month-value">R$ 165,20</div>
            <div class="month-name">Jul / {{ selectedYear }}</div>
          </div>
          <div class="month-bar future">
            <div class="bar-container">
              <div class="bar-value future-bar" style="height: 85%"></div>
            </div>
            <div class="month-value">R$ 220,80</div>
            <div class="month-name">Ago / {{ selectedYear }}</div>
          </div>
          <div class="month-bar future">
            <div class="bar-container">
              <div class="bar-value future-bar" style="height: 45%"></div>
            </div>
            <div class="month-value">R$ 115,60</div>
            <div class="month-name">Set / {{ selectedYear }}</div>
          </div>
          <div class="month-bar future">
            <div class="bar-container">
              <div class="bar-value future-bar" style="height: 75%"></div>
            </div>
            <div class="month-value">R$ 190,50</div>
            <div class="month-name">Out / {{ selectedYear }}</div>
          </div>
          <div class="month-bar future">
            <div class="bar-container">
              <div class="bar-value future-bar" style="height: 90%"></div>
            </div>
            <div class="month-value">R$ 240,20</div>
            <div class="month-name">Nov / {{ selectedYear }}</div>
          </div>
          <div class="month-bar future">
            <div class="bar-container">
              <div class="bar-value future-bar" style="height: 95%"></div>
            </div>
            <div class="month-value">R$ 300,10</div>
            <div class="month-name">Dez / {{ selectedYear }}</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="income-details-section">
    <div class="section-header">
      <h2>Proventos Recebidos</h2>
      <div class="filters">
        <div class="filter-dropdown" (click)="$event.stopPropagation()">
          <div class="dropdown-trigger" (click)="toggleIncomeDetailsDropdown(incomeDetailsDropdowns[0])">
            <span>{{ incomeDetailsDropdowns[0].label }}</span>
            <span class="dropdown-icon">▼</span>
          </div>
          <ul class="dropdown-menu" *ngIf="incomeDetailsDropdowns[0].isOpen">
            <li
              *ngFor="let option of incomeDetailsDropdowns[0].options"
              (click)="selectIncomeDetailsOption(incomeDetailsDropdowns[0], option)"
            >
              {{ option }}
            </li>
          </ul>
        </div>

        <div class="filter-dropdown" (click)="$event.stopPropagation()">
          <div class="dropdown-trigger" (click)="toggleIncomeDetailsDropdown(incomeDetailsDropdowns[1])">
            <span>{{ incomeDetailsDropdowns[1].label }}</span>
            <span class="dropdown-icon">▼</span>
          </div>
          <ul class="dropdown-menu" *ngIf="incomeDetailsDropdowns[1].isOpen">
            <li
              *ngFor="let option of incomeDetailsDropdowns[1].options"
              (click)="selectIncomeDetailsOption(incomeDetailsDropdowns[1], option)"
            >
              {{ option }}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="income-table-container">
      <table class="income-table">
        <thead>
          <tr>
            <th>Data</th>
            <th>Ativo</th>
            <th>Tipo de Renda</th>
            <th>Quantidade</th>
            <th>Valor por Ação</th>
            <th>Valor Total</th>
            <th>Rendimento (%)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let income of filteredIncomeData">
            <td>{{ income.date }}</td>
            <td class="asset-name">
              <div class="asset-icon" [ngClass]="{
                'stock': income.incomeType === 'Dividendo',
                'fixed-income': income.incomeType === 'Juros'
              }"></div>
              {{ income.asset }}
            </td>
            <td>
              <span class="income-type" [ngClass]="{
                'dividend': income.incomeType === 'Dividendo',
                'interest': income.incomeType === 'Juros'
              }">
                {{ income.incomeType }}
              </span>
            </td>
            <td>{{ income.quantity }}</td>
            <td>R$ {{ income.valuePerShare.toFixed(2) }}</td>
            <td>R$ {{ income.totalValue.toFixed(2) }}</td>
            <td>
              <span class="rendimento-value">{{ income.yield.toFixed(1) }}</span>
              <span class="rendimento-trend positive">▲</span>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="pagination">
        <button class="pagination-btn">Anterior</button>
        <div class="page-numbers">
          <span class="page-number active">1</span>
          <span class="page-number">2</span>
          <span class="page-number">3</span>
        </div>
        <button class="pagination-btn">Próximo</button>
      </div>
    </div>
  </section>
</div>
